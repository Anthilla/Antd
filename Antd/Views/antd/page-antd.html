@Master['layout.html']
<!-------------------------------------------------------------------------------------
//     Copyright (c) 2014, Anthilla S.r.l. (http://www.anthilla.com)
//     All rights reserved.
//
//     Redistribution and use in source and binary forms, with or without
//     modification, are permitted provided that the following conditions are met:
//         * Redistributions of source code must retain the above copyright
//           notice, this list of conditions and the following disclaimer.
//         * Redistributions in binary form must reproduce the above copyright
//           notice, this list of conditions and the following disclaimer in the
//           documentation and/or other materials provided with the distribution.
//         * Neither the name of the Anthilla S.r.l. nor the
//           names of its contributors may be used to endorse or promote products
//           derived from this software without specific prior written permission.
//
//     THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
//     ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
//     WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
//     DISCLAIMED. IN NO EVENT SHALL ANTHILLA S.R.L. BE LIABLE FOR ANY
//     DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
//     (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
//     LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
//     ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
//     (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
//     SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
//     20141110
//------------------------------------------------------------------------------------->
@Section['PageBar']
<style type="text/css">
	#Config-TB {
		border-bottom: 10px solid #A7BD39;
		height: 80px !important;
	}

	div.row {
		margin-top: 20px !important;
	}
</style>
@EndSection

@Section['MainContent']
<nav class="vertical-menu">
    <ul class="bg-anthilla-gray fg-anthilla-green" style="width: 15%; padding: 5px 15px; margin-left: 0 !important; margin-top: 0 !important; float: left;">
        @Each.AntdContext
		<li><a href="#" data-role="load-page" data-page="@Current" class="fg-hover-white upcase">@Current</a></li>
        @EndEach
    </ul>
</nav>
<div data-role="page-container" style="min-height: 250px; float: right; width: 85%;">
</div>
@EndSection

@Section['Scripts']
<script data-context="new-pageload" type="text/javascript">
    $('[data-role="load-page"]').on("click", function () {
        AbortAllAjaxRequests();
        var page = $(this).attr('data-page');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/part/load/' + page,
            type: 'GET',
            success: function (data) {
                $('[data-role="page-container"]').html(data);
            }
        });
        _requests.push(aj);
    });
</script>
<script type="text/javascript">
    $('[data-role="ToggleNextRow"]').on("click", function () {
        var id = $(this).attr('data-id');
        $('[data-hidden="' + id + '"]').toggle();
    });
</script>
<script data-context="gluster" type="text/javascript">
    $('[data-role="AddGlusterConfigNewNode"]').on("click", function () {
        var html = '<div class="input-control text" data-role="input-control"><input name="GlusterNode" type="text" value="@Current" style="width: 90%;"></div>';
        $('[data-role="GlusterConfigNewNodes"]').append(html);
    });

    $('[data-role="AddGlusterConfigNewVolume"]').on("click", function () {
        var html = '<div class="input-control text border-anthilla-gray" data-role="input-control"><input name="GlusterVolumeName" type="text" value="@Current.Name" style="width: 90%;"><input name="GlusterVolumeBrick" type="text" value="@Current.Brick" style="width: 90%;"><input name="GlusterVolumeMountPoint" type="text" value="@Current.MountPoint" style="width: 90%;"></div>';
        $('[data-role="GlusterConfigNewVolumes"]').append(html);
    });
</script>
<script data-context="pageload" type="text/javascript">
    $(document).on("ready", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/part/update',
            type: 'GET',
            success: function (data) {
                $('[data-render="part-update"]').html(data);
            }
        });
        _requests.push(aj);
    });

    $(document).on("ready", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/part/storage',
            type: 'GET',
            success: function (data) {
                $('[data-render="part-storage"]').html(data);
            }
        });
        _requests.push(aj);
    });

    $(document).on("ready", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/part/info/losetup',
            type: 'GET',
            success: function (data) {
                $('[data-render="part-info-losetup"]').html(data);
            }
        });
        _requests.push(aj);
    });

    $(document).on("ready", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/part/scheduler',
            type: 'GET',
            success: function (data) {
                $('[data-render="part-scheduler"]').html(data);
            }
        });
        _requests.push(aj);
    });

    $(document).on("ready", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/part/ssh',
            type: 'GET',
            success: function (data) {
                $('[data-render="part-ssh"]').html(data);
            }
        });
        _requests.push(aj);
    });

</script>
<script data-context="overlay" type="text/javascript">
    $('[data-role="SetOverlayDirectory"]').on("click", function () {
        var dir = $(this).attr('data-dir');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: "/overlay/directory",
            type: "POST",
            data: {
                Directory: dir
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });
</script>
<script data-context="cron" type="text/javascript">
    $('#ShowCronInfo').on("click", function () {
        $('#CronDashboard').show();
    });

    $('#HideCronInfo').on("click", function () {
        $('#CronDashboard').hide();
    });

    $('[data-role="EditCronJob"]').on("click", function () {
        var guid = $(this).attr('data-guid');
        var command = $(this).parents('td').find('textarea').val();
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: "/scheduler/edit",
            type: "POST",
            data: {
                Guid: guid,
                Command: command
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('[data-role="DeleteCronJob"]').on("click", function () {
        var guid = $(this).attr('data-guid');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: "/scheduler/delete",
            type: "POST",
            data: {
                Guid: guid
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('[data-role="DisableCronJob"]').on("click", function () {
        var guid = $(this).attr('data-guid');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: "/scheduler/disable",
            type: "POST",
            data: {
                Guid: guid
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('[data-role="EnableCronJob"]').on("click", function () {
        var guid = $(this).attr('data-guid');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: "/scheduler/enable",
            type: "POST",
            data: {
                Guid: guid
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('[data-role="LaunchCronJob"]').on("click", function () {
        var guid = $(this).attr('data-guid');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: "/scheduler/launch",
            type: "POST",
            data: {
                Guid: guid
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });
</script>
<script data-context="general" type="text/javascript">
    $(document).on("ready", function () {
        $('div[data-role="hide-selectize"]').find('#show-units').hide();
    });

    $('#ReloadSystemInfo').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/system/import/info',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('.search-field').keyup(function () {
        var context = $(this).attr('data-searchable');
        var queryString = $(this).val();
        var tableBody = $('.searchable[data-searchable="' + context + '"]').find('tbody');
        var row = tableBody.children('tr');
        row.each(function () {
            var thisRow = $(this);
            var queriedText = $(this).text();
            if (queriedText.indexOf(queryString) !== -1) {
                thisRow.show();
            }
            if (queriedText.indexOf(queryString) < 0) {
                thisRow.hide();
            }
        });
    });

    $(document).on("ready", function () {
        $.when(
            LoadUserEntitiesUnits()
        ).then();
    });

    var UserSelectizerOptions = function () {
        return {
            load: function (query, callback) {
                if (!query.length) return callback();
                var aj = $.ajax({
                    url: this.settings.remoteUrl,
                    type: "GET",
                    dataType: "json",
                    data: {
                        s: query
                    },
                    error: function () {
                        callback();
                    },
                    success: function (data) {
                        callback(data);
                    }
                });
                _requests.push(aj);
                return callback;
            },
            render: function (data, escape) {
                return '<div><span data-guid="' + escape(data.guid) + '" class="button name bg-anthilla-violet">' + String(data.alias) + "</span></div>";
            }
        };
    }();

    var $userEntitiesSelectizer = $("#userEntities").selectize({
        delimiter: ",",
        persist: false,
        valueField: "guid",
        labelField: "alias",
        searchField: ["alias", "guid"],
        render: { option: UserSelectizerOptions.render },
        remoteUrl: "/users/json",
        load: UserSelectizerOptions.load,
        sortField: "alias"
    });

    function LoadUserEntitiesUnits() {
        if ($("#userEntities").size() > 0) {
            var userEntitiesSelectizer = $userEntitiesSelectizer[0].selectize;
            userEntitiesSelectizer.load(function (callback) {
                Callback(callback, this.settings.remoteUrl);
                $("#userEntities").hide();
            });
        }
    }

    //////////////////////////////////////////////////////////////////

    $('select[name="Assignment"]').focusout(function () {
        var selectedoption = $(this).find('option:selected').val();
        if (selectedoption === "user") {
            $('#UserAssignmentRow').show();
            $('#ServiceAssignmentRow').hide();
        }
        if (selectedoption === "service") {
            $('#UserAssignmentRow').hide();
            $('#ServiceAssignmentRow').show();
        }
    });

    $('select[name="Assignment"]').on("click", function () {
        var selectedoption = $(this).find('option:selected').val();
        if (selectedoption === "user") {
            $('#UserAssignmentRow').show();
            $('#ServiceAssignmentRow').hide();
        }
        if (selectedoption === "service") {
            $('#UserAssignmentRow').hide();
            $('#ServiceAssignmentRow').show();
        }
    });

    $('[data-role="CertificateAuthoritySetup"]').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/ca/setup',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('[data-role="CreateNewCertificate"]').on("click", function () {
        var name = $(this).prev('input[name="CertificateName"]').val();
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/ca/certificate/new',
            type: 'POST',
            data: {
                Certificate: name
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('[data-role="InvertSslOption"]').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/ca/ssl/toggle',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('[data-role="ChangeCertificatePath"]').on("click", function () {
        var path = $(this).prev('input[name="CertificatePath"]').val();
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/ca/cert/set',
            type: 'POST',
            data: {
                CertificatePath: path
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('[data-role="submit-general-function"]').on("click", function () {
        var command = $(this).attr('data-command');
        var param = $(this).prev('[data-role="input-general-function"]').val();
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/terminal/direct/post',
            type: 'POST',
            data: {
                Command: command.replace("[tag:x]", param)
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('[data-role="submit-general-function-from-text"]').on("click", function () {
        var command = $(this).attr('data-command');
        var param = $(this).prev('[data-role="show-general-function"]').text();
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/terminal/direct',
            type: 'POST',
            data: {
                Command: command.replace("[tag:x]", param)
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $(document).on("ready", function () {
        $('textarea[data-role="show-general-function"]').each(function () {
            var t = $(this);
            var command = t.attr('data-command');
            jQuery.support.cors = true;
            var aj = $.ajax({
                url: '/terminal/direct',
                type: 'POST',
                data: {
                    Command: command
                },
                success: function (data) {
                    t.text(data);
                }
            });
            _requests.push(aj);
        });
        $('select[data-role2="show-general-function"]').each(function () {
            var t = $(this);
            var command = t.attr('data-command');
            jQuery.support.cors = true;
            var aj = $.ajax({
                url: '/terminal/direct',
                type: 'POST',
                data: {
                    Command: command
                },
                success: function (data) {
                    var arr = data.split('\n');
                    $.each(arr, function (i, value) {
                        t.append('<option Value="' + value + '">' + value + '</option>');
                    });
                }
            });
            _requests.push(aj);
        });
    });

    $('p.edit-conf').on("click", function () {
        var path = $(this).attr('data-path');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/system/read/file/' + path,
            type: 'GET',
            dataType: 'json',
            contentType: 'application/json;charset=utf-8',
            success: function (text) {
                var dashboard = $('#FileConfigDashboard');
                dashboard.find('#title').text('Editing: ' + path);
                dashboard.find('input[name="FilePath"]').val(path);
                dashboard.find('textarea[name="FileContent"]').text(text);
                dashboard.show();
                //todo scrollup to dashboard
                return false;
            }
        });
        _requests.push(aj);
    });

    $('p.export-conf').on("click", function () {
        var p = $(this).attr('data-path');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/system/export/file/' + p,
            type: 'POST',
            data: JSON.stringify(p),
            contentType: "application/json;charset=utf-8",
            success: function () {
                location.reload(true);
                return false;
            }
        });
        _requests.push(aj);
    });

    $('input#close').on("click", function () {
        var form = $('form');
        form.find('input').val('');
        form.find('textarea').text('');
        form.hide();
    });

    $('input#clear').on("click", function () {
        var form = $('form');
        form.find('input').val('');
        form.find('textarea').text('');
    });
</script>
<script data-context="firewall" type="text/javascript">

    $('[data-role="SaveNftConfiguration"]').on("click", function () {
        var tables = [];
        $('[data-nft="Table"]').each(function () {
            var self = $(this);
            var tableType = self.attr('data-nft-type');
            var tableName = self.attr('data-nft-name');

            var tableSets = [];
            self.find('[data-nft="Set"]').each(function () {
                var selfSet = $(this);
                var setName = selfSet.attr('data-nft-name');
                var elements = self.find('[data-nft="SetElements"]').text();
                var set = {
                    Name: setName,
                    Elements: elements
                };
                tableSets.push(set);
            });

            var tableChains = [];
            self.find('[data-nft="Set"]').each(function () {
                var selfChain = $(this);
                var chainName = selfChain.attr('data-nft-name');
                var rules = self.find('[data-nft="ChainRules"]').text();
                var chain = {
                    Name: chainName,
                    RulesString: rules,
                    Rules: null
                };
                tableChains.push(chain);
            });

            var table = {
                Type: tableType,
                Name: tableName,
                Sets: tableSets,
                Chains: tableChains
            };
            tables.push(table);
        });
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/nft/save',
            type: 'POST',
            dataType: 'json',
            data: {
                Data: JSON.stringify(tables)
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $(document).on("ready", function () {
        $('.autoheight').each(function () {
            this.style.height = "1px";

            var text = $(this).val();
            var lines = text.split(/\r|\r\n|\n/);
            var count = lines.length;
            console.log(count);

            this.style.height = (count * 20) + "px";
        });
    });

    $('input[data-role="enable-mac-address"]').on("click", function () {
        var guid = $(this).attr('data-object-guid');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/firewall/enable/macadd',
            type: 'POST',
            data: {
                Guid: guid
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('input[data-role="disable-mac-address"]').on("click", function () {
        var guid = $(this).attr('data-object-guid');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/firewall/disable/macadd',
            type: 'POST',
            data: {
                Guid: guid
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#ReloadMacAddressList').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/firewall/discover/macadd',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('div[data-object="ruleset"]').dblclick(function () {
        var table = $(this).attr('data-table');
        var type = $(this).attr('data-type');
        var hook = $(this).attr('data-hook');
        var db = $('#NewListDashboard');
        db.find('[name="Table"]').val(table);
        db.find('[name="Type"]').val(type);
        db.find('[name="Hook"]').val(hook);
        $('[data-role="display-table-context"]').text(table + ' ' + type + ' ' + hook);
        $(window).scrollTop($('#ValueBundleDashboard').offset().top - 50);
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/firewall/getrule/' + table + '/' + type + '/' + hook,
            type: 'GET',
            dataType: 'json',
            contentType: 'application/json;charset=utf-8',
            success: function (data) {
                var container = $('#FirewallConfigurationLists');
                container.html('');
                $.each(data, function (i, list) {
                    var row = '<tr data-index="' + i + '"><td style="width:200px;"><p style="display:inline-block;" class="fg-white">'
                        + list.Label +
                        '</p></td><td><input type="text" data-guid="' + list.Guid + '" style="height: 25px; width: 90%;" class="bg-anthilla-gray fg-white" value="'
                        + list.ReplaceValues + '"/></td><td><i class="icon-cycle fg-anthilla-violet on-left" data-guid="' + list.Guid +
                        '" data-role="firewall-reload-values" data-backup="'
                        + list.ReplaceValues +
                        '" style="cursor: pointer !important;"></i><i data-role="firewall-update-values" data-guid="' + list.Guid +
                        '" class="icon-checkmark fg-anthilla-green on-left style="cursor: pointer !important;""></i>' +
                        '</td></tr>';
                    container.append(row);
                    ReloadListValues();
                    SaveListValues();
                });

                var aj2 = $.ajax({
                    url: '/firewall/getruleset/' + table + '/' + type + '/' + hook,
                    type: 'GET',
                    dataType: 'json',
                    contentType: 'application/json;charset=utf-8',
                    success: function (rules) {
                        $('#RuleList').html('');
                        $.each(rules, function (i, rule) {
                            var row = '<tr data-index="' + i + '"><td style="width:200px;"></td><td>' + rule + '</td></tr>';
                            $('#RuleList').append(row);
                        });
                        return false;
                    }
                });
                _requests.push(aj2);

                return false;
            }
        });
        _requests.push(aj);
    });

    function ReloadListValues() {
        $('[data-role="firewall-reload-values"]').on("click", function () {
            var guid = $(this).attr('data-guid');
            var bkup = $(this).attr('data-backup');
            $('input[data-guid="' + guid + '"]').val(bkup);
            return false;
        });
    }

    function SaveListValues() {
        $('[data-role="firewall-update-values"]').on("click", function () {
            var guid = $(this).attr('data-guid');
            var el = $('input[data-guid="' + guid + '"]').val();
            jQuery.support.cors = true;
            var aj = $.ajax({
                url: networkUrl + '/ipv4/disable/if',
                type: 'POST',
                data: {
                    Guid: guid,
                    Elements: el
                },
                success: function () {
                    location.reload(true);
                }
            });
            _requests.push(aj);
        });
    }

    $('i[data-role="stop-rule"]').on("click", function () {
        var guid = $(this).attr('data-guid');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/firewall/stoprule',
            type: 'POST',
            data: {
                Guid: guid
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#ApplyFirewallConfiguration').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/firewall/conf/export',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#ExportFirewallConfiguration').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/firewall/conf/export',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });
</script>
<script data-context="network" type="text/javascript">
    $('#ShowNetworkVirtualIf').on("click", function () {
        $('[data-show="NetworkVirtualIf"]').toggle();
    });

    $('#ReloadNetworkInterfacesInformation').on("click", function () {
        $(this).addClass();
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/network/import',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });
</script>
<script data-context="Mount" type="text/javascript">
    $('i.show-units-mgmt').on("click", function () {
        var g = $(this).attr('data-guid');
        $('tr.Mount-units[data-guid="' + g + '"]').toggle();
    });

    $('input[data-role="show-dashboard"]').on("click", function () {
        var g = $(this).attr('data-guid');
        $('#AntdMountdDashboard').toggle();
        $('#AntdMountdDashboard').find('input[name="Guid"]').val(g);
        $('#AntdMountdDashboard').find('input[name="Mount"]').val($(this).attr('data-mntpth'));
    });

    $('i[data-role="remove-this-unit"]').on("click", function () {
        var g = $(this).attr('data-guid');
        var u = $(this).attr('data-unit');
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/system/Mount/unit',
            type: 'DELETE',
            data: {
                Guid: g,
                Unit: u
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });
</script>
<script data-context="users" type="text/javascript">
    $(document).on("ready", function () {
        $('input[type="text"]').each(function () {
            $(this).val('');
        });
        $('input[type="password"]').each(function () {
            $(this).val('');
        });
    });

    $('[data-role="UpdateUserPassword"]').on("click", function () {
        var user = $(this).attr('data-user');
        var container = $(this).parents('[data-role="UpdatePasswordPanel"]');
        var pass = container.find('[data-role="Password01"]').val();
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/users/change/password',
            type: 'POST',
            data: {
                User: user,
                Password: pass
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });
</script>
<script data-context="services" type="text/javascript">
    $('.search-field').keyup(function () {
        var tableReference = $(this).attr('data-table');
        var searchIn = $('table[data-search="' + tableReference + '"]').find('tbody');
        var queryString = $(this).val();
        var row = searchIn.children('tr');
        row.each(function () {
            var thisRow = $(this);
            var queriedText = $(this).text();
            if (queriedText.indexOf(queryString) !== -1) {
                thisRow.show();
            }
            if (queriedText.indexOf(queryString) < 0) {
                thisRow.hide();
            }
        });
    });

    //START SAMBA
    $('#ActivateSamba').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/activate/samba',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#RefreshSamba').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/refresh/samba',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#ReloadSamba').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/reloadconfig/samba',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#ShowSambaStructure').mousedown(function () {
        $('#SambaStructure').show();
    }).mouseup(function () {
        $('#SambaStructure').hide();
    });;

    $(document).on("ready", function () {
        $('#SambaForm').find('tr[data-object="samba-parameter"]').each(function (index) {
            var dataKey = $(this).find('[name="DataKey"]');
            dataKey.attr('name', dataKey.attr('name') + '_' + index);
            var dataValue = $(this).find('[name="DataValue"]');
            dataValue.attr('name', dataValue.attr('name') + '_' + index);
            var dataFile = $(this).find('[name="DataFilePath"]');
            dataFile.attr('name', dataFile.attr('name') + '_' + index);
        });
    });

    $(document).on("ready", function () {
        $('[data-share-form]').each(function () {
            $(this).find('[data-object="share-parameter"]').each(function (index) {
                var dataKey = $(this).find('[name="DataKey"]');
                dataKey.attr('name', dataKey.attr('name') + '_' + index);
                var dataValue = $(this).find('[name="DataValue"]');
                dataValue.attr('name', dataValue.attr('name') + '_' + index);
                var dataFile = $(this).find('[name="DataFilePath"]');
                dataFile.attr('name', dataFile.attr('name') + '_' + index);
            });
        });
    });

    $('#AddNewParameterSamba').on("click", function () {
        $('#NewParameterSambaDashboard').toggle();
    });

    $('#AddNewShare').on("click", function () {
        $('#NewSambaShare').toggle();
    });
    //END SAMBA

    //START BIND
    $('#ActivateBind').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/activate/bind',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#RefreshBind').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/refresh/bind',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#ReloadBind').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/reloadconfig/bind',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $(document).on("ready", function () {
        $.when(
            $('input[data-array="bind"]').selectize({
                delimiter: ';',
                persist: false,
                create: function (input) {
                    return {
                        value: input,
                        text: input
                    }
                }
            })
        ).done(function () {
            $('.selectize-input.items').find('div.item[data-Value=""]').remove();
            $('input[data-array="bind"]').hide();
        });
    });

    $(document).on("ready", function () {
        $('form[data-role="bind-section-update"]').each(function () {
            $(this).find('[data-object="bind-parameter"]').each(function (index) {
                var dataKey = $(this).find('[name="DataKey"]');
                dataKey.attr('name', dataKey.attr('name') + '_' + index);
                var dataValue = $(this).find('[name="DataValue"]');
                dataValue.attr('name', dataValue.attr('name') + '_' + index);
                var dataFile = $(this).find('[name="DataFilePath"]');
                dataFile.attr('name', dataFile.attr('name') + '_' + index);
            });
        });
    });

    $('#AddNewAclBind').on("click", function () {
        $('#NewAclBindDashboard').toggle();
    });

    $('#AddNewKeyBind').on("click", function () {
        $('#NewKeyBindDashboard').toggle();
    });

    $('#AddNewMastersBind').on("click", function () {
        $('#NewMastersBindDashboard').toggle();
    });

    $('#AddNewServerBind').on("click", function () {
        $('#NewServerBindDashboard').toggle();
    });

    $('#AddNewViewBind').on("click", function () {
        $('#NewViewBindDashboard').toggle();
    });

    $('#AddNewZoneBind').on("click", function () {
        $('#NewZoneBindDashboard').toggle();
    });
    //END BIND

    //START DHCP
    $('#ActivateDhcp').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/activate/dhcp',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#RefreshDhcp').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/refresh/dhcp',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#ReloadDhcp').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/reloadconfig/dhcp',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#ShowDhcpStructure').mousedown(function () {
        $('#DhcpStructure').show();
    }).mouseup(function () {
        $('#DhcpStructure').hide();
    });;

    $(document).on("ready", function () {
        $('#DhcpForm').find('tr[data-object="dhcp-parameter"]').each(function (index) {
            var dataKey = $(this).find('[name="DataKey"]');
            dataKey.attr('name', dataKey.attr('name') + '_' + index);
            var dataValue = $(this).find('[name="DataValue"]');
            dataValue.attr('name', dataValue.attr('name') + '_' + index);
            var dataFile = $(this).find('[name="DataFilePath"]');
            dataFile.attr('name', dataFile.attr('name') + '_' + index);
        });
    });

    $(document).on("ready", function () {
        $('[data-share-form]').each(function () {
            $(this).find('[data-object="share-parameter"]').each(function (index) {
                var dataKey = $(this).find('[name="DataKey"]');
                dataKey.attr('name', dataKey.attr('name') + '_' + index);
                var dataValue = $(this).find('[name="DataValue"]');
                dataValue.attr('name', dataValue.attr('name') + '_' + index);
                var dataFile = $(this).find('[name="DataFilePath"]');
                dataFile.attr('name', dataFile.attr('name') + '_' + index);
            });
        });
    });

    $('#AddNewParameterDhcp').on("click", function () {
        $('#NewParameterDhcpDashboard').toggle();
    });

    $('#AddNewShare').on("click", function () {
        $('#NewDhcpShare').toggle();
    });

    $(document).on("ready", function () {
        $.when(
            $('input[data-array="dhcp"]').selectize({
                delimiter: ';',
                persist: false,
                create: function (input) {
                    return {
                        value: input,
                        text: input
                    }
                }
            })
        ).done(function () {
            $('.selectize-input.items').find('div.item[data-Value=""]').remove();
            $('input[data-array="dhcp"]').hide();
        });
    });
    //END DHCP

    //START SSH
    $('#ActivateSsh').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/activate/ssh',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#RefreshSsh').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/refresh/ssh',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#ReloadSsh').on("click", function () {
        jQuery.support.cors = true;
        var aj = $.ajax({
            url: '/services/reloadconfig/ssh',
            type: 'POST',
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('#ShowSshStructure').mousedown(function () {
        $('#SshStructure').show();
    }).mouseup(function () {
        $('#SshStructure').hide();
    });;

    $(document).on("ready", function () {
        $('#SshForm').find('tr[data-object="ssh-parameter"]').each(function (index) {
            var dataKey = $(this).find('[name="DataKey"]');
            dataKey.attr('name', dataKey.attr('name') + '_' + index);
            var dataValue = $(this).find('[name="DataValue"]');
            dataValue.attr('name', dataValue.attr('name') + '_' + index);
            var dataFile = $(this).find('[name="DataFilePath"]');
            dataFile.attr('name', dataFile.attr('name') + '_' + index);
        });
    });

    $(document).on("ready", function () {
        $('[data-key-form]').each(function () {
            $(this).find('[data-object="key-parameter"]').each(function (index) {
                var dataKey = $(this).find('[name="DataKey"]');
                dataKey.attr('name', dataKey.attr('name') + '_' + index);
                var dataValue = $(this).find('[name="DataValue"]');
                dataValue.attr('name', dataValue.attr('name') + '_' + index);
                var dataFile = $(this).find('[name="DataFilePath"]');
                dataFile.attr('name', dataFile.attr('name') + '_' + index);
            });
        });
    });

    $('#AddNewParameterSsh').on("click", function () {
        $('#NewParameterSshDashboard').toggle();
    });

    $('#AddNewKey').on("click", function () {
        $('#NewSshKey').toggle();
    });
    //END SSH
</script>
<script data-context="storage" type="text/javascript">
    $('[data-role="CreatePartitionTable"]').on("click", function () {
        var d = $(this).attr('data-name');
        var t = $(this).parents('td').find('select > option:selected').val();
        var aj = $.ajax({
            url: "/parted/mklabel",
            type: "POST",
            data: {
                Disk: d,
                Type: t,
                Confirm: "Yes"
            },
            success: function () {
                var aj = $.ajax({
                    url: "/parted/print",
                    type: "POST",
                    data: {
                        Disk: d
                    },
                    success: function (data) {
                        $('[data-partitiontable="' + g + '"]').text(data);
                    }
                });
            }
        });
        _requests.push(aj);
    });

    $('[data-role="show-disk-details-0"]').on("click", function () {
        var g = $(this).attr('data-guid');
        $('[data-row="' + g + '"]').toggle();
        var d = $(this).attr('data-name');
        var aj = $.ajax({
            url: "/parted/print",
            type: "POST",
            data: {
                Disk: d
            },
            success: function (data) {
                $('[data-partitiontable="' + g + '"]').text("Partition Table: " + data);
                if (data !== "unknown") {
                    $('[data-button="' + g + '"]').addClass("disabled").attr('disabled', 'disabled');
                }
            }
        });
        _requests.push(aj);
    });

    $('[data-role="show-details"]').on("click", function () {
        var g = $(this).attr('data-guid');
        $('[data-row="' + g + '"]').toggle();
    });

    $('[data-role="EnablePoolSnap"]').on("click", function () {
        var pool = $(this).attr('data-pool');
        var interval = $(this).parents('td').find('select > option:selected').val();
        var aj = $.ajax({
            url: "/zfs/snap",
            type: "POST",
            data: {
                Pool: pool,
                Interval: interval
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });

    $('[data-role="DisablePoolSnap"]').on("click", function () {
        var id = $(this).attr('data-id');
        var aj = $.ajax({
            url: "/zfs/snap/disable",
            type: "POST",
            data: {
                Guid: id
            },
            success: function () {
                location.reload(true);
            }
        });
        _requests.push(aj);
    });
</script>
@EndSection