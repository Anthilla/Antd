angular.module("ngJsonExplorer",[]).directive("jsonExplorer",["$http",function(n){"use strict";return{restrict:"E",scope:{data:"=",jsonData:"=",url:"=",collapsed:"=",sortBy:"="},link:function(a,l,e){function r(n){var e=null;if(angular.isObject(n))e=n;else try{e=JSON.parse(n)}catch(n){return void(e={error:"invalid json"})}u(e)&&a.sortBy&&(e=e.sort(function(n,l){var e=a.sortBy.split(":"),r=e[0],s=e[1],t=n[r],i=l[r],o=null;if("number"==typeof t&&"number"==typeof i)o=function(n,a){return n-a};else{if(!t.hasOwnProperty("length")||!i.hasOwnProperty("length"))return;o=function(n,a){return n.length-a.length}}return"asc"==s?o(t,i):"desc"==s?o(i,t):o(t,i)})),u(e)?h='[<ul class="array">':c(e)&&(h='{<ul class="object">');for(var r in e){var s=r,t=e[r];o(t)?h+="<li>"+d(s,t)+",</li>":u(t)?h+="<li>"+f(s,t)+",</li>":c(t)&&(h+="<li>"+g(s,t)+",</li>")}h=h.replace(/,<\/li>$/gim,"</li>"),u(e)?h+="</ul>]":c(e)&&(h+="</ul>}"),l.html('<div class="angular-json-explorer">'+h+"</div>");for(var i=l[0].getElementsByTagName("a"),p=0;p<i.length;p++){var v=i[p];angular.element(v).on("click",function(n){n.preventDefault();var a=angular.element(this).parent().next(),l=angular.element(this).parent().next().next();"+"==this.innerHTML?(a.addClass("hidden"),l.removeClass("hidden"),this.innerHTML="-"):(a.removeClass("hidden"),l.addClass("hidden"),this.innerHTML="+")})}}angular.isBoolean||(angular.isBoolean=function(n){return"boolean"==typeof n});var s="+",t="",i="hidden";a.collapsed&&(s="-",t="hidden",i="");var o=function(n){return angular.isString(n)||angular.isNumber(n)||angular.isBoolean(n)||null===n},u=function(n){return angular.isArray(n)},c=function(n){return angular.isObject(n)},p=function(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},d=function(n,a){var l="";return n&&(l='<span class="prop>">'+n+"</span>: "),"string"==typeof a?l+'<span class="string">"'+p(a)+'"</span>':"number"==typeof a?l+'<span class="num">'+a+"</span>":"boolean"==typeof a?l+'<span class="bool">'+a+"</span>":l+'<span class="null">'+a+"</span>"},f=function(n,a){var l='<span class="prop>"><a href="#" class="collapser">'+s+"</a></span> [";n&&(l='<span class="prop>"><a href="#" class="collapser">'+s+"</a>"+n+"</span>: ["),l+='<span class="ellipsis '+t+'">...</span>',l+='<ul class="array collapsible '+i+'">';for(var e=0;e<a.length;e++)o(a[e])?l+="<li>"+d(null,a[e])+",</li>":u(a[e])?l+="<li>"+f(null,a[e])+",</li>":c(a[e])&&(l+="<li>"+g(null,a[e])+",</li>");return l=l.replace(/,<\/li>$/gim,"</li>"),l+="</ul>",l+="]"},g=function(n,a){var l='<span class="prop>"><a href="#" class="collapser">'+s+"</a></span> {";n&&(l='<span class="prop>"><a href="#" class="collapser">'+s+"</a>"+n+"</span>: {"),l+='<span class="ellipsis '+t+'">...</span>',l+='<ul class="object collapsible '+i+'">';for(var e in a)o(a[e])?l+="<li>"+d(e,a[e])+",</li>":u(a[e])?l+="<li>"+f(e,a[e])+",</li>":c(a[e])&&(l+="<li>"+g(e,a[e])+",</li>");return l=l.replace(/,<\/li>$/gim,"</li>"),l+="</ul>",l+="}"},h="";a.$watch("url",function(l){if(l){(angular.isString(l)?n.get(l):n(l)).then(function(n){a.requestData=n})}}),a.$watch("[data, jsonData]",function(n){n[0]?r(n[0]):n[1]&&r(n[1])},!0),a.$watch("requestData",function(n){n&&r(n)}),a.$watch("collapsed",function(n){if(void 0!=n)for(var a=l[0].getElementsByTagName("a"),e=0;e<a.length;e++){var r=a[e],s=angular.element(r).parent().next(),t=angular.element(r).parent().next().next();1==n?"-"==r.innerHTML&&(s.removeClass("hidden"),t.addClass("hidden"),r.innerHTML="+"):"+"==r.innerHTML&&(s.addClass("hidden"),t.removeClass("hidden"),r.innerHTML="-")}})}}}]);